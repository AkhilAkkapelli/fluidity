<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE testproblem SYSTEM "regressiontest.dtd">

<testproblem>
  <name>darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag</name>
  <owner userid="btollit"/>
  <tags>diml</tags>
  <problem_definition length="short" nprocs="1">
    <command_line>
../../bin/darcy_impes darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_A.diml 

cp darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_A.diml darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_B.diml 
sed -i 's/_A/_B/' darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_B.diml

../../bin/darcy_impes darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_B.diml 

rm -f darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_B.diml

cp darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_A.diml darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_C.diml 
sed -i 's/_A/_C/' darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_C.diml

../../bin/darcy_impes darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_C.diml 

rm -f darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_C.diml

cp darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_A.diml darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_D.diml 
sed -i 's/_A/_D/' darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_D.diml

../../bin/darcy_impes darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_D.diml 

rm -f darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_D.diml

./Run_Compare_Numerical_To_Analytic_1d_Multiple.py

    </command_line>
    <!-- One/two/three dimensional problem for darcy flow using the IMPES solver with one region and one material using p1 element type with 2 phases using Corey relative permeabilities with a TotalDarcyVelocity BC at the inlet, a strong pressure BC at outlet and the first phase saturation diagnostic. Different CV face value schemes are tested in 1,2 and 3d. In 1d the order of convergence is checked. -->
  </problem_definition>
  <variables>
    <variable name="AB_CV_L2Norm_convergence_sat" language="python">
from math import log

A_error_file = open("darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_A_17_output_error_norm.txt", "r")
B_error_file = open("darcy_impes_p1_2phase_coreyrelperm_velBCinlet_strongpressoutlet_p1satdiag_p2satupwind_1d_B_33_output_error_norm.txt", "r")

for line in A_error_file:
   
   if line.strip[0] == 'CV' .and. line.strip[1] == 'L2':
      
      A_l2_error = float(line.strip[3])
      
for line in B_error_file:
   
   if line.strip[0] == 'CV' .and. line.strip[1] == 'L2':
      
      B_l2_error = float(line.strip[3])

print A_l2_error
print B_l2_error

AB_l2_ratio   = A_l2_error   / B_l2_error
AB_CV_L2Norm_convergence_sat = log(AB_l2_ratio, 2)
    </variable>

    <variable name="solvers_converged" language="python">
import os
files = os.listdir("./")
solvers_converged = not "matrixdump" in files and not "matrixdump.info" in files
    </variable>
  </variables>
  <pass_tests>
    <test name="Solvers converged" language="python">
assert(solvers_converged)
    </test>
    <test name="AB_CV_L2Norm_convergence_sat: 0.9 < order < 1.1" language="python">
assert(abs(AB_CV_L2Norm_convergence_sat - 1.0) &lt; 0.1)
    </test>
  </pass_tests>
  <warn_tests>
  </warn_tests>
</testproblem>
